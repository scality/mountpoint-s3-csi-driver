apiVersion: batch/v1
kind: Job
metadata:
  name: create-test-buckets
spec:
  template:
    spec:
      restartPolicy: Never
      containers:
      - name: bucket-creator
        image: amazon/aws-cli:2.13.0
        env:
        - name: AWS_ACCESS_KEY_ID
          valueFrom:
            secretKeyRef:
              name: s3-secret
              namespace: scality-s3-csi
              key: access_key_id
        - name: AWS_SECRET_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              name: s3-secret
              namespace: scality-s3-csi
              key: secret_access_key
        - name: AWS_DEFAULT_REGION
          value: "us-east-1"
        - name: S3_ENDPOINT_URL
          value: "http://s3.scality.com:8000"
        command:
        - /bin/sh
        - -c
        - |
          echo "Creating test buckets..."
          aws s3 mb s3://upgrade-test-bucket-1 --endpoint-url ${S3_ENDPOINT_URL} || echo "Bucket 1 may already exist"
          aws s3 mb s3://upgrade-test-bucket-2 --endpoint-url ${S3_ENDPOINT_URL} || echo "Bucket 2 may already exist"
          echo "Test buckets created successfully"